# Diffusion Geometry Journal

Use one entry per hypothesis or implementation batch.

## Entry Template
- Timestamp:
- Commit:
- Hypothesis:
- Files touched:
- Commands:
- Baseline:
- Results:
- Numeric checks:
- Decision: `kept` | `rejected` | `deferred`
- Notes:

## 2026-02-14 Wave 1 Baseline
- Timestamp: 2026-02-14T00:00:00Z
- Commit: 78ae77b (working tree before Wave 1 implementation)
- Hypothesis: Baseline current Hodge/spectral behavior and lock reproducible regression evidence before changes.
- Files touched:
  - `notes/diffusion/journal.md` (new)
- Commands:
  - `cmake --build build -j8`
  - `./build/igneous-hodge`
  - `ctest --test-dir build --output-on-failure`
- Baseline:
  - `igneous-hodge` large torus run (`n=4000`, `basis=64`) reports:
    - `lambda_0 = 0.0106422`
    - `lambda_1 = 0.0307465`
    - `lambda_2 = 0.056302`
  - This is inconsistent with expected near-harmonic low modes (`~1e-5` scale).
- Results:
  - Full existing test suite passes (`7/7`), indicating current tests do not detect this regression.
- Numeric checks:
  - `ctest`: pass
  - Hodge run: deterministic reproduction of non-harmonic low-mode issue
- Decision: `kept`
- Notes:
  - This entry establishes the pre-fix reference point for Wave 1.

## Math Regression Checklist
- [x] `compute_eigenbasis` solver-path diagnostics and residual checks.
- [x] Hodge low-mode envelope guard on canonical torus case.
- [x] Circular-coordinate dynamic-range guard.
- [x] 1-form decomposition reconstruction and orthogonality checks.
- [x] `carre_du_champ` bilinearity/symmetry/positivity checks.
- [x] transform/flow/curvature invariants and no-op checks.

## 2026-02-14 Spectral Solver Safety Gate
- Timestamp: 2026-02-14T00:00:00Z
- Commit: working tree after baseline
- Hypothesis: Restrict symmetric spectral solve to diffusion graphs that pass strict reversibility diagnostics; otherwise force generic Arnoldi path to avoid non-harmonic low Hodge modes.
- Files touched:
  - `include/igneous/data/topology.hpp`
  - `include/igneous/ops/spectral.hpp`
- Commands:
  - `cmake --build build -j8`
  - `./build/igneous-hodge`
  - `ctest --test-dir build --output-on-failure`
- Baseline:
  - Large torus run emitted `lambda_0 = 0.0106422`, `lambda_1 = 0.0307465`.
- Results:
  - Added additive spectral options (`auto|generic|symmetric`) and diagnostics.
  - Added topology-side spectral diagnostics and cached spectral eigenvalues.
  - Auto mode now reports reversibility and selects generic solve on non-reversible graph.
  - Large torus run now emits:
    - `lambda_0 = 2.56507e-05`
    - `lambda_1 = 3.29904e-05`
- Numeric checks:
  - `ctest`: pass (`7/7`)
- Decision: `kept`
- Notes:
  - Fix restores expected near-harmonic low-mode behavior while keeping symmetric path available explicitly.

## 2026-02-14 Circular Coordinate Paper Alignment
- Timestamp: 2026-02-14T00:00:00Z
- Commit: working tree after spectral gate
- Hypothesis: Align circular-coordinate defaults with paper-style regularization while preserving practical angle quality on the torus benchmark.
- Files touched:
  - `include/igneous/ops/hodge.hpp`
  - `src/main_hodge.cpp`
- Commands:
  - `cmake --build build -j8`
  - `./build/igneous-hodge`
  - `ctest --test-dir build --output-on-failure`
- Baseline:
  - Existing default used `epsilon=1e-3` and identity-style regularization.
- Results:
  - Added additive `CircularCoordinateOptions`.
  - Default epsilon is now `1.0f`.
  - Default path now regularizes using Laplacian-based term with calibrated scale for current discretization.
  - Added deterministic circular diagnostics in `main_hodge` output.
  - Current large torus run now reports:
    - `theta_0 range=[0.000466881, 0.999998], std=0.288768`
    - `theta_1 range=[0.000101466, 0.999627], std=0.281885`
- Numeric checks:
  - `ctest`: pass (`7/7`)
- Decision: `kept`
- Notes:
  - Raw unscaled `epsilon * Delta` over-regularized this discretization and collapsed angular spread; retained Laplacian regularization with explicit scale parameter to preserve paper-aligned structure and practical stability.

## 2026-02-14 1-Form Hodge Decomposition API
- Timestamp: 2026-02-14T00:00:00Z
- Commit: working tree after circular-coordinate update
- Hypothesis: Introduce an additive decomposition API for 1-forms (exact/harmonic/coexact) using Gram-aware projection and harmonic-mode extraction.
- Files touched:
  - `include/igneous/ops/hodge.hpp`
  - `src/main_hodge.cpp`
- Commands:
  - `cmake --build build -j8`
  - `./build/igneous-hodge`
  - `ctest --test-dir build --output-on-failure`
- Baseline:
  - No direct API existed for 1-form decomposition.
- Results:
  - Added `HodgeDecomposition1Options`, `HodgeDecomposition1Result`, and `compute_hodge_decomposition_1form(...)`.
  - Added non-bench demo export path for decomposition-derived vector fields in `main_hodge`.
  - Large torus demo now reports decomposition norms:
    - `exact = 1.56617e-05`
    - `harmonic = 172.495`
    - `coexact = 0.000150313`
- Numeric checks:
  - `ctest`: pass (`7/7`)
- Decision: `kept`
- Notes:
  - Decomposition currently uses a stable regularized normal equation for exact projection and low-eigenvalue projection for the harmonic component.

## 2026-02-14 Headless Hodge Report Tooling
- Timestamp: 2026-02-14T00:00:00Z
- Commit: working tree after decomposition API
- Hypothesis: Add a default headless quality-report workflow (JSON + PNG artifacts) so Hodge regressions can be detected without GUI dependencies.
- Files touched:
  - `scripts/diffusion/report_hodge.py`
  - `src/main_hodge.cpp`
- Commands:
  - `cmake --build build -j8`
  - `./build/igneous-hodge`
  - `python3 scripts/diffusion/report_hodge.py --input-dir output_hodge --output-json output_hodge/report_hodge_metrics.json --metrics-file output_hodge/hodge_metrics.json`
- Baseline:
  - No machine-readable Hodge metrics/artifacts were generated by default.
- Results:
  - `main_hodge` now writes `output_hodge/hodge_metrics.json`.
  - Added `report_hodge.py` that emits:
    - consolidated JSON report (`report_hodge_metrics.json`)
    - quicklook PNG projections for angle/harmonic/decomposition PLY outputs.
  - Built-in checks in report currently pass:
    - `harmonic_low_mode_envelope = true`
    - `circular_coordinate_dynamic_range = true`
- Numeric checks:
  - report generation completed successfully with expected artifacts.
- Decision: `kept`
- Notes:
  - This becomes the default non-GUI inspection path; PyVista scripts remain optional.

## 2026-02-14 Foundational Operator Regression Tests
- Timestamp: 2026-02-14T00:00:00Z
- Commit: working tree after headless tooling
- Hypothesis: Add deterministic transform/geometry regression tests plus stronger curvature/flow invariants to catch mathematical drift early.
- Files touched:
  - `tests/support/test_env.hpp`
  - `tests/support/tolerances.hpp`
  - `tests/support/synthetic_meshes.hpp`
  - `tests/test_ops_transform.cpp`
  - `tests/test_ops_geometry.cpp`
  - `tests/test_ops_curvature_flow.cpp`
  - `CMakeLists.txt`
- Commands:
  - `cmake --build build -j8`
  - `ctest --test-dir build --output-on-failure`
- Baseline:
  - No dedicated transform/geometry invariant suite.
- Results:
  - Added deterministic test support and new tests for:
    - normalize invariants/idempotence
    - `carre_du_champ` symmetry/bilinearity/near-positivity
    - 1-form Gram symmetry + PSD envelope
    - curvature translation invariance
    - mean-curvature-flow `dt=0` no-op and smoothing proxy
  - Test count increased from `7` to `9`.
- Numeric checks:
  - `ctest`: pass (`9/9`)
- Decision: `kept`
- Notes:
  - Runtime impact is minimal and within balanced CI budget.

## 2026-02-14 Spectral + Hodge Regression Guards
- Timestamp: 2026-02-14T00:00:00Z
- Commit: working tree after foundational operator tests
- Hypothesis: Add medium-size spectral/Hodge regression tests to prevent recurrence of large-graph harmonic-mode and circular-coordinate failures.
- Files touched:
  - `tests/test_ops_spectral_regression.cpp`
  - `tests/test_ops_hodge_regression.cpp`
  - `CMakeLists.txt`
- Commands:
  - `cmake --build build -j8`
  - `ctest --test-dir build --output-on-failure`
- Baseline:
  - No automated guard for the large-torus `lambda_0 ~ 1e-2` regression path.
- Results:
  - Added solver-path and eigen-residual checks in spectral regression test.
  - Added canonical torus Hodge regression with near-zero low-mode envelope and circular dynamic-range checks.
  - Test count increased from `9` to `11`.
- Numeric checks:
  - `ctest`: pass (`11/11`)
- Decision: `kept`
- Notes:
  - This suite now fails on the previously observed spectral/Hodge regression and passes on the corrected implementation.

## 2026-02-14 Hodge Decomposition Regression Tests
- Timestamp: 2026-02-14T00:00:00Z
- Commit: working tree after spectral/hodge regression guards
- Hypothesis: Add decomposition-specific regression checks to guarantee reconstruction and Gram-orthogonality properties.
- Files touched:
  - `tests/test_ops_hodge_decomposition.cpp`
  - `CMakeLists.txt`
- Commands:
  - `cmake --build build -j8`
  - `ctest --test-dir build --output-on-failure`
- Baseline:
  - No decomposition-specific mathematical regression test coverage.
- Results:
  - Added decomposition test checking:
    - reconstruction error
    - pairwise near-orthogonality under Gram metric
    - low harmonic energy for projected harmonic component
  - Test count increased from `11` to `12`.
- Numeric checks:
  - `ctest`: pass (`12/12`)
- Decision: `kept`
- Notes:
  - This closes the Wave 1 decomposition validation loop.
